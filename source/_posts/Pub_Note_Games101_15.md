---
title: Games101 15.Ray Tracing 3(Light Transport & Global Illumination)
---

## Radiometry

- 物体一直接受光照，为什么颜色没有一直发生变化？因为物体也在一直辐射能量。当然对于一些特殊的材质，比如荧光的，就得考虑这个问题。

### Irradiance

![Alt text](image.png)

- 单位面积指的是跟入射光线垂直的这个方向，这个才算是接收到的范围大小。不然就得把它投影到垂直方向上。

![Alt text](image-1.png)

- 这就跟前面我们在 Blinn-Phong 模型中提到的 Lambert's Cosine Law 有关。

![Alt text](image-2.png)

- 就像地球上不同地方有冬天有夏天一样，这是因为阳光和不同区域的夹角不一样。阳光垂直于某一个区域，那它接受能量就多，不垂直就接收能量就少。

![Alt text](image-3.png)

- 另外，我们在前面 Blind-Phong 模型中提到的点光源，它在传播的过程中，会有一个$r^2$的衰减。这个衰减并不是 intensity 的衰减，而是 irradiance 的衰减。

### Radiance

![Alt text](image-4.png)

- Radiance 是为了描述光在一条线上的传播过程中的属性。
  ![Alt text](image-5.png)
- Radiance 在立体角和面积上都有一个微分
- 比如说一个单位面积它可能往各个方向都会辐射能量，我们要研究这个面往一个方向辐射能量会怎么样
- 也可能是朝向某个方向，但是是一个大的平面。面积越大，辐射的能量自然就越多。我们要研究单位面积往一个方向辐射的能量是多少。
- 因此把这两个方面都考虑到，就是 radiance。

根据它的定义，我们可以把 radiance 和之前的概念联系起来：
![Alt text](image-6.png)

incident radiance（入射辐射度）：
![Alt text](image-7.png)

- 能量可能往不同的方向辐射，我们只考虑从某个方向进来的能量，被这个面收到了多少。

exiting radiance（出射辐射度）：
![Alt text](image-8.png)

- 只考虑单位面积往某个方向辐射的能量。

Irradiance 和 Radiance 之间的关系：
![Alt text](image-9.png)

- Irradiance 就是来自四面八方的 radiance。

### Bidirectional Reflectance Distribution Function（双向反射分布函数）

![Alt text](image-10.png)

- 光线打到镜子会反射到某一个方向，打到漫反射物体会往四面八方都会去。我们需要一个函数来描述这样的性质。
- 这个函数描述了从某个方向进来能量，被吸收了，然后再从这个物体表面发出去，到另一个方向上有多少能量。

![Alt text](image-11.png)

- dL 是什么意思呢？我觉得可以理解为$w_i$方向入射的光对这个反射方向的贡献。如果是 L 的话那就是所有入射角度的积分了。
- 不过还有一个让我困惑的点，为什么是 dL/dE 而不是 L/L 或者 dE/dE 呢？这里有一个解释，但我其实不太认同：[光照模型和 BRDF](https://blog.csdn.net/weixin_41978699/article/details/121112077)
- BRDF 描述了光线是如何跟物体作用的，它其实就定义了不同材质是怎么样的。

![Alt text](image-12.png)

- 如果我们把各个方向（半球）上的入射光都考虑，也就是做一个积分。那么我们就可以得到这个点在所有可能的入射光下最后反射到这个方向上看起来是什么样的。

### Rendering Equation

在渲染方程之前，我们先提一下目前有个困难：
![Alt text](image-13.png)

- 入射光不只是来自光源，还可能来自其他物体。也就是说，任何一个面接收到光源的照射，它会反射出去一些 radiance。这些 radiance 又可以用来照亮其他的面。这就是一个递归的定义方式。

渲染方程：
![Alt text](image-14.png)

- 前面反射方程中没有考虑到物体自己发光的情况。如果物体自己发光，那么我们就需要把这个发光的 radiance 加上去。
- $\Omega$跟上面的$H^2$是一个意思，表示半球，然后 cosine 表示为了点乘的写法。
- 渲染方程是现代图形学的基础，所有限制在物体表面上的光线传播都满足这个方程。

![Alt text](image-15.png)

- 多个光源就是把每一个光源的入射光都考虑进去，然后加起来就可以了。

![Alt text](image-16.png)

- 光源也不一定是点光源，如果是面光源，可以考虑成点光源的集合，会从不同的角度照射过来。因此我们需要对各个方向角进行积分。

![Alt text](image-17.png)

- 入射的 radiance 不一定是来自光源，也可能是来自其他物体反射过来的。
- 可以看到这里的渲染方程它是一个递归的表示。

这就是当年的渲染方程对应的那张图：
![Alt text](image-18.png)

- 当时渲染方程可以支持光线弹射多次，我们就可以看到反射或者阴影之类的东西。

我们把渲染方程简写成这样一个积分：
![Alt text](image-19.png)
进一步简写：
![Alt text](image-20.png)

- 把积分写成了乘积的形式，这个在数学上有严格定义，但这里不考虑怎么做的，直接说了（算子法解微分方程）。

为什么要这么写呢？为了解渲染方程：
![Alt text](image-21.png)

- 写成这种算子形式好处在于，这个算子本身有类似泰勒展开的性质。我们可以把这个算子展开，然后就可以得到不同反射次数的光线传播的结果。

![Alt text](image-22.png)

- 直接光照：光源直接照射到物体上的光照。（直接看到光源或者光源从物体上反射出来的光）
- 间接光照：光线弹射一次或者多次后照射到物体上的光照再到摄像机上。
- 全局光照：把各种次数的光线弹射的结果加起来。全局光照等于直接光照加上间接光照。
- 光栅化很难处理间接光照，而光线追踪则可以很好地处理这个问题。

![Alt text](image-23.png)

- 光源无法直接打到的地方就是黑的
  ![Alt text](image-24.png)
- P 点还是比较黑
  ![Alt text](image-25.png)
- P 点变亮了
  ![Alt text](image-26.png)
- 反弹次数多了结果基本上不会有太大变化，会逐渐收敛。
- 另外，我们在渲染方程里考虑的都是单位时间内的光照，如果是相机快门一直开着，那么就会出现过曝的现象。
- 路径追踪实际上就是在解全局光照或者说渲染方程的一种方式。

## Probability Review

下面复习一下下节课会用到的概率论的知识：

随机变量：
![Alt text](image-27.png)
![Alt text](image-28.png)

期望：
![Alt text](image-29.png)
概率密度函数：
![Alt text](image-30.png)

- 曲线下形成的面积才是概率
- 概率密度函数的整个积分等于 1

如果是一个函数而不是一个随机变量：
![Alt text](image-31.png)

- 这个是为了后续的蒙特卡洛积分做准备。
